![Image1forYellowstone](https://github.com/MorpheusAIs/Morpheus/assets/1563345/80a6c1cf-fe52-42ba-bfd4-91d9faf67f07)

# Модель Вычислений Морфеус “Yellowstone” 
### Erik Voorhees
### 3е января 2023

Предложенная редакция структуры токеномики Morpheus для стимулирования вычислений в децентрализованной сети ИИ
Просмотр в Notion: https://defiant-wolfsbane-830.notion.site/Morpheus-Yellowstone-Compute-Model-2ca9b4e7e1374c898937fdbd1b964cc1


## Краткое содержание
В модели вычислений Yellowstone сеть Morpheus выплачивает провайдерам вознаграждение только за фактически предоставленные вычислительные мощности через конкурентный процесс торгов, а также выделяет ограниченный выпуск Токенов (прим. единица измерения запросов к ИИ) пропорционально количеству удерживаемых токенов MOR, а не на основе платежей. Это существенно улучшает пользовательский опыт, минимизируя при этом уязвимость к атакам типа Sybil. Yellowstone также вводит важные метрики времени и прохождения теста "Pass/Fail", чтобы гарантировать, что поставщики вычислений действуют достаточно оперативно и точно. Yellowstone сохраняет конфиденциальность, не направляя запросы или результаты через маршрутизатор, и минимизирует транзакции в блокчейне для обеспечения масштабируемости. С помощью этой модели MOR приобретает фундаментальную ценность, предоставляя постоянный (но ограниченный) доступ к вычислениям без необходимости проведения транзакций на каждую операцию вывода.

Если данное предложение будет принято, оно заменит раздел "Compute Proof, Registration & Reward" в белой книге Morpheus (https://github.com/MorpheusAIs/Morpheus/blob/main/WhitePaper%20Russian.md)

## Контекст
Morpheus использует токеномику для стимулирования предоставления достаточного и масштабируемого вычислительного ресурса для децентрализованного и неограниченного генеративного ИИ. В первоначальной концепции Morpheus выделял 24% эмиссии MOR напрямую провайдерам вычислительных мощностей, пропорционально полученным запросам, и отдавал приоритет в запросах тем провайдерам, у которых было больше MOR.

### Из оригинальной белой книги:
"MOR-комиссии за транзакции, сжигаемые каждым провайдером вычислений, служат доказательством его статуса и приносят ему пропорциональную долю токенов MOR каждый день.

Например, если существует 100 провайдеров вычислений в день запуска сети, то каждый из них получит пропорциональное вознаграждение в зависимости от количества MOR, которое он сжег через комиссии. В данном случае, предположим, что каждый из 100 провайдеров вычислений сжег 100 MOR, тогда 1% из 3 456 MOR ежедневно = 34.56 MOR".

### Однако у этого подхода есть три основных проблемы:
1) Он требует от пользователей оплаты комиссии за каждую операцию вывода. Даже если это дешево, это существенное препятствие, которое вызовет плохой пользовательский опыт и постоянное отставание от OpenAI. Кроме того, требуется как минимум одна транзакция в блокчейне на каждую операцию, что, вероятно, не сможет масштабироваться даже на L2. Каждая операция имеет чрезвычайно низкую стоимость и если будет необходима транзакция в блокчейне, то операции станут экономчески нецелесообразными.  
2) Эта модель существенно подвержена уязвимостям, потому что ожидаемые доходы для провайдеров вычислений гораздо выше фактических затрат на вычисления. Таким образом, злоумышленник может засыпать свой собственный узел провайдера запросами на операции, зарабатывая относительно большую часть токенов MOR каждый день, даже если никакой экономической ценности никому не предоставлено. Это, вероятно, приведет к большим объемам неиспользуемых вычислений, которые исчезнут, как только исчезнет огромная возможность дохода, а потраченные за этот период MOR будут потеряны.
3) Если запросы на операции вывода распределяются в зависимости от количества MOR, удерживаемого провайдерами, то сеть игнорирует производительность этих провайдеров (время отклика) и стоимость их вычислительной обработки. Именно эти два фактора сеть должна пытаться оптимизировать (время отклика и стоимость вычислений должны стремиться быть минимальными). Если провайдер с наибольшим количеством MOR использует GPU за 200 долларов, выпущенную когда он еще учился в колледже, производительность операций для многих пользователей будет чрезвычайно низкой. Приоритет должен базироваться на цене предложения вычислений и производительности, а не количестве удерживаемых MOR. 

Ниже представлена модель "Yellowstone", которая модифицирует токеномику Morpheus для предоставления вычислительных ресурсов, чтобы решить указанные выше проблемы. Эта модель работает независимо от того, какая часть эмиссии выделена на вычисления, и мы будем предполагать сохранение текущего статуса, где 24% общей эмиссии выделено на вычисления.

### Цели:
1) Позволить пользователям не платить за каждую операцию вывода (в идеале, вообще не платить)
2) Достигнуть эффективного, масштабируемого и устойчивого предоставления вычислительных ресурсов без переплаты
3) Стимулировать конкуренцию по времени отклика и стоимости среди поставщиков вычислительных ресурсов
4) Минимизировать количество блокчейн-транзакций (будь то L2 или другие)
5) Продемонстрировать экономически обоснованный фундаментальный спрос на MOR

## Модель Yellowstone
Включает в себя четыре компонента:

### Пользователи
- Имеют запросы
- Хотят быстрого/точного вычисления бесплатно и без цензуры/наблюдения
  
### Провайдеры
- Имеют вычислительные ресурсы
- Хотят денег (MOR)

### Маршрутизатор
- Имеет высокую пропускную способностью
- В начале может быть относительно централизованным, в конечном итоге должен децентрализоваться

## Стандартные весы и меры
В ИИ есть атомная единица операций выводов измеряемая в выводах в секунду (inferences/second IPS). Это можно концептуально сравнить с WEI на блокчейне. Выводы используются для определения тарифов в маршрутизаторе Yellowstone. Вес одной единицы искусственного интеллекта Morpheus, следовательно, представляет собой вывод. В зависимости от типа запроса это может быть применено к любой вычислительной задаче.

По мере слияния ИИ и блокчейна, Morpheus стремится предоставить открытый стандарт измерений, чтобы уточнить терминологию, используемую как ИИ, так и блокчейном.

Существует два типа запросов, определенных размером возвращаемого моделью ответа:  

**Запросы с определенной длиной**, где ответ учитывает длину возвращаемого ответа. Примеры включают:
- Чат/Создание изображения
- Диагностика болезней
- Распознавание объектов
- Выявление мошенничества

  **Запросы с неопределенной длиной** требуют ресурсов для ответа, которые можно узнать только после создания ответа. Примеры таких запросов:
- Спой сонату о спагетти
- Создай видеопоздравление С днем рождения
- Совмести модель X с моделью Y
- Разрежь 3D-модель в файл .stl

Yellowstone фокусируется на запросах с определенной длиной. Описанный маршрутизатор будет построен так, чтобы в будущем обрабатывать также и запросы с неопределенной длиной, но не для обслуживания их сегодня. Для достижения этого мы используем стандартизированное измерение децентрализованного ИИ (DeAI).

## Тарифы децентрализованного ИИ

### Выражения вывода в секунду:

| Тип | Ответ | Тариф |
|------|----------|------|
| Определенный | Язык | Выведенные Токены в секунду (TPS) |
| Неопределенный - медиа | Аудио | Выведенные образцы в секунду (ISPS) |
| Неопределенный - медиа | Видео | Выведенные кадры в секунду (IFPS) |
| Неопределенный - будущие технологии | Неизвестный будущий формат | Н/Д |

Первая единица измерения операций вывода для маршрутиризатора Yellowstone это Токены. Форматы других выводов будут представлены далее.

### Время

Время блока для вывода составляет 12 секунд, что означает, что блок вывода транзакций публикуется и учитывается 5 раз в минуту.

### Контракт вычислений
- Общедоступный смарт-контракт, который получает эмиссию MOR, отслеживает начисления и удержания у поставщиков и выплачивает им награды при вызове.

"Пользователи": определены как любой участник, у которого есть адрес MOR и который отправляет запросы маршрутиризатору на использование вычисления. Это может быть конкретное лицо, отправляющее запросы с локальной версии Morpheus, или это может быть бот, или это может быть компания или веб-сайт от третьей стороны, который взаимодействует с сетью Morpheus от имени своих конечных пользователей (использование выводов конечными пользователями не отслеживается или не учитывается в контракте вычислений, за исключением случаев сбоя операций вывода).

"Поставщики": определены как любой участник, поддерживающий работу узла предоставляющего ресурсы для вычислений, имеющий адрес MOR и предлагающий ставки на Токены через маршрутиризатор. Когда поставщик выигрывает ставку, он предоставляет ресурсы для вычислений (графические процессоры и т.д.) для различных пользовательских моделей ИИ.

"Маршрутиризатор": определен как программное приложение, имеющее адрес MOR и являющееся посредником между пользователями и поставщиками в двустороннем рынке. Маршрутиризатор регистрирует и отслеживает адреса и ставки поставщиков, обрабатывает запросы от пользователей, записывает [миллисекунды] результаты тестов Pass/Fail обработанных запросов и указывает контракту вычислений начислять средства по мере необходимости поставщикам в MOR. Маршрутиризатор никогда не отправляет и не получает транзакции MOR (или транзакции на любом блокчейне) и никогда не видит содержимого запроса или ответа.

"Контракт вычислений": определен как смарт-контракт, имеющий адрес MOR, который получает всю эмиссию MOR выделенную для вычислений, отслеживает суммы, которые должны быть выплачены поставщикам, и выплачивает MOR поставщикам при запросе.

"Токен" ("T"): это самое маленькое количество букв или пикселей, предложенных через маршрутиризатор. Часто это примерно 4 символа текста или 5x5 пикселей изображения и т.д. Не путайте это с токенами блокчейна, такими как токены ERC20 или сам токен MOR.

"TokenMax" относится к максимальному количеству токенов, принимаемых для оплаты маршрутиризатором.

"RFC" означает "Запрос на вычисление". Пользователь отправляет RFC маршрутиризатору и указывает [LLM], к которой пользователь хочет получить доступ, а также [TokenMax], который является пределом приемлемых T в ответе. Пользователю следует ограничивать это количество, потому что более высокие числа = более долгое ожидание ответов и считаются большим вкладом в [UserMax], который ограничен каждый день.

### Contract Protections

In order to prevent an attack that shorts or runs the number of MOR by manipulating  using any unused compute, the pool of unused MOR allocated to Compute Providers can be reduced by no more than 1% per block day. This is equal to normal compute emisions + 1%.

### Защиты контракта

Для предотвращения атак, направленных на манипулирование неиспользуемыми вычислениями, пул неиспользованных MOR, выделенных поставщикам вычислений, может уменьшаться не более чем на 1% в блок день, что соответствует обычным вычислительным эмиссиям + 1%.

### Стимул для инициализации вычислений

В течение первого года после завершения 90ти дневного периода инициализации, топ-100 поставщиков вычислений будут иметь право на пропорциональную часть в размере 2,4% от эмиссии MOR. Это рассчитывается маршрутизаторами и учитывается в контракте вычислений.

## Процесс работы
1) Пользователи, поставщики и маршрутизатор создают публичные ключи MOR (это их идентификатор и подпись для всех сообщений).
2) Если у пользователя положительный баланс MOR, пользователь может отправить подписанное сообщение с запросом на обработку "RFP" маршрутизатору. Пользователь указывает [LLM] и [TokenMax].
3) Маршрутизатор упорядочивает запросы на обработку на основе баланса MOR пользователя (решает проблему сибила).
4) Маршрутизатор выбирает поставщика, поддерживающего [LLM], с приоритетом наименьшей ставки Token в MOR.
5) Маршрутизатор отправляет проверку активности поставщику. Если проверка пройдена, то
6) Маршрутизатор соединяет пользователя с поставщиком.
7) Пользователь отправляет запрос ([LLM], [запрос]) поставщику.
8) Поставщик вычисляет запрос, отправляет результат пользователю.
9) Пользователь сообщает время [миллисекунды] между шагами 4 и 5, [Токены] доставлены, и результат прошел/не прошел маршрутизатору.
10) Маршрутизатор инструктирует контракт вычислений начислить поставщику MOR, если [миллисекунд] на [Токен] не хуже чем на X% ниже среднего значения по прошлым Z запросам для этого [LLM] и если пользователь сообщил [Пройдено].   
(11) (Через некоторое время) Поставщик запрашивает выплату MOR из контракта вычислений, и контракт вычислений отправляет выплату MOR, если она действительна.

![ComputeContractImage2](https://github.com/MorpheusAIs/Morpheus/assets/1563345/e66ea20c-9851-4f9e-9caa-66c6d798c462)

## Результат
* Пользователь получил быстрый результат для своего запроса и не заплатил ничего (это приведет к удивительному пользовательскому опыту и, следовательно, к широкому принятию). **Решает Цель 1.**
* Контракт вычислений оплачивает вычисления через конкурентный процесс ставок и проверку качества/удовлетворенности от пользователя, который их заказал. **Решает Цель 2.**
* Поставщик получает деньги (MOR) от контракта вычислений, при условии достаточно быстрого ответа. Поставщик получает ровно то, о чем просил за предоставление вычислений. Если ставка поставщика слишком высока, другие будут делать более низкие ставки, таким образом система эффективна и будет снижать цены поставщиков к стоимости базовой электроэнергии.  **Решает Цель 3**
* Количество онлайн-транзакций было минимизировано (много тысяч запросов может проходить без единой онлайн-транзакции). **Решает Цель 4**
* Возможность получить быстрое, бесплатное вычисление стимулирует спрос на токены MOR среди пользователей. **Решает Цель 5**
* Шаги 6 и 7 обеспечивают разумную конфиденциальность (запрос никогда не касается маршрутизатора, так же как и результат). Поставщики выбираются относительно случайным образом и никогда не узнают личность пользователя, кроме IP-адреса. Более высокий уровень конфиденциальности может быть достигнут позднее с использованием TOR + FHE.
* Баланс MOR был уменьшен из контракта вычислений. Контракт будет платежеспособным, пока уплаченный MOR < заработанного MOR за период от эмиссии.
* Если пользователь отправляет RFC, превышающий UserMax пользователя, маршрутизатор отклонит запрос.

-------------

## Бюджет вычислений
Сети Morpheus необходимо определить, сколько MOR она готова потратить на вычисления в определенный период (например, каждый день). Это называется Бюджетом вычислений. Каждый период Контракт вычислений может тратить не более этого количества MOR. Это число, умноженное на цену MOR, дает нам бюджет в долларах на приобретение вычислений каждый день.

## Уровень доступа (AccessRate)
Сеть Morpheus распределяет дефицитный ресурс производства T через концепцию "AccessRate" (Уровень доступа). AccessRate определяет, сколько Ts каждый токен MOR может использовать в день. Неиспользованный доступ не накапливается. AccessRate всегда отображается как количество Ts на 1 токен MOR (например, 1 MOR = 15 000 T). AccessRate определяется частично с помощью MaxT, который количественно оценивает максимальное количество Ts, которые сеть может закупить в день.

**AccessRate** = (1/Общее количество MOR) * MaxT
**MaxT** = ((Бюджет вычислений MOR * Цена MOR) / Цена T) * 1000
**UserMax** = MaxT * Баланс MOR пользователя


### Пример показателей: 
**Общее количество MOR** = 10,000,000 MOR  
**Бюджет вычислений MOR** = 3,000 MOR в день 
**Цена MOR** = $20  
**Цена T** = $0.002 за 1000 Ts  
**Баланс MOR пользователя** = 5 MOR tokens  

### Пример результата:
**MaxT** = 30,000,000,000 Ts (максимум T, который сети может приобрести/произвести в день)  
**AccessRate** = 3,000 (таким образом, каждый токен MOR предоставляет доступ к 3,000 T в день)  
**UserMax** = 15,000 (пользователь с балансом 5 MOR может получить доступ к 15,000 T в день)  

- Each period (each day), Morpheus as a network has enough funds to buy X number of Ts from compute Providers. X is a function of the amount of MOR the Compute Contract is willing to spend (the “Compute Budget”) multiplied by the current MOR price divided by the market rate for Ts. 
- If the Compute Budget is 3,000 MOR, and each is worth $20, then the network can buy (produce) up to $60,000 of Ts that day. If the going rate for 1,000 Ts is $0.002, then the network can buy up to 30 billion Ts (30m x 1000 Ts). 
- That potential production of 30 billion Ts is allocated by MOR balance, pro rata. Assume there are 10,000,000 MOR in existence. A user with 500 MOR tokens (0.005% of total) could freely access up to 1.5m Ts that day. 
- So long as Compute Budget is at or below the emissions level, the Compute Contract cannot run out of MOR.  
- In reality, most tokens will sit in wallets and exchanges, and only a fraction will be used to demand the T production.

## Notes
1) Fundamental demand for MOR comes from Users who wish to have access to generative AI and other forms of compute on the Morpheus network. 
 
2) Provider’s hardware type is irrelevant to the network, so long as they satisfy the User’s pass/fail test. Any Provider bidding on more Queries than they can efficiently process will be penalized by failing this test.

3) The above model importantly pays Providers ONLY when there is demand for their compute. This prevents the situation where large portions of MOR are emitted prematurely when the network doesn’t need it. 

4) Providers should need to prove they have a given LLM, by signing hash of LLM model with their key. This doesn’t prove they used it, but it proves they downloaded and installed it, which represents work, thus preventing some forms of sybil-sensitive fraud. If Providers provide garbage results to User, User can send [Fail] along with [miliseconds] back to Router, and Provider won’t be credited for that compute. Morpheus doesn’t need all answers to be perfect… it only needs enough answers to be good enough, relative to competing alternatives. 

5) Sybil attacks of flooding the network with RFCs is prevented by the AccessRate. The “cost” of sending and RFC is the cost of acquiring a MOR token divided by the number of RFCs submitted on its behalf. Cost is thus never zero, and yet a user won’t feel a loss each time an RFC is made. 

6) Pass/Fail is determined by User, and polices quality to some degree. User conveys Pass/Fail result alongside [miliseconds] back to Router. If Fail, either no reward or penalty point (TBD). There is no incentive to falsely Fail a Provider (no monetary incentive in doing so). This mechanism prevents Providers from sending fast but useless Results.
Consider: perhaps No Reward occurs on Fail only if User MOR > Provider MOR. Otherwise, just a negative point which Router can use in its privatization logic.

7) All four parties (User, Provider, Router, and Compute Contract) have unique MOR address as their identity. All messages between the parties require signatures (but most don’t require blockchain txs)

8) Providers must have non-zero balance to discourage Sybil attack from Provider side.

9) If [milisecond] criteria is higher, network will be generally faster, but discourages smaller Providers

10) There is a disincentive to provide slow Results (no revenue after computation)
  
11) Centrally hosted Router to start is probably fine (decentralize Router eventually (IPFS? Or PoS node consortium?))
